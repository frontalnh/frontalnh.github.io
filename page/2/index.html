<!DOCTYPE html>
<html class="has-navbar-fixed-top">

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Jake.Lee&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">






<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="/css/style.css">
<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

</head>

<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">Archives</a>
            
            <a class="navbar-item " href="/categories">Categories</a>
            
            <a class="navbar-item " href="/tags">Tags</a>
            
            <a class="navbar-item " href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" href="https://github.com/frontalnh">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

        <section class="section">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6354931397950820",
    enable_page_level_ads: true
  });
</script>

    <div class="container">
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/03/22/building-node-api-server-based-on-ddd-architecture/" itemprop="url">
                Building node API server based on DDD architecture
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-03-22T07:02:12.000Z" itemprop="datePublished">
                a month ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/nodejs/">nodejs</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                7 minutes read (About 992 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <h1><span id="building-node-api-server-based-on-ddd-architecture">Building node API server based on DDD architecture</span></h1><h2><span id="domain-layer">Domain Layer</span></h2><p>Domain 레이어는 각 서브 도메인 마다 model, service, repository를 가지며 다음과 같은 역할을 수행한다.</p>
<p>-   Model</p>
<p>​    해당 도메인의 모델링이 정의되고, 해당 도메인 내에서의 항상성과 유효성을 담당한다.</p>
<p>-   Service</p>
<p>​    주로 여러 도메인을 아우르는 로직을 처리한다.</p>
<p>-   Repository</p>
<p>​    도메인 단위로 DB 입출력을 담당하며, 실제 구현은 infra layer의 repository implementation에서 이루어 지며, interface만 정의되어 있다.</p>
<h2><span id="api-layer">API Layer</span></h2><p>도메인의 서비스들을 조합하며 엔드 유저 레벨에서의 기능수행이 이루어 진다.</p>
<p>가령 특정 재화를 구매함에 따라 결제를 수행하는 어플리케이션이 있다면 본 api 레이어에는 ‘결제’와 같은 엔드 유저 레벨에서의 함수가 들어가며, 결제 데이터 생성, 구매자의 감소 등과 같은 로직은 도메인의 모델 및 서비스 레벨에서 처리된다.</p>
<h2><span id="infra-layer">Infra layer</span></h2><p>도메인의 비즈니스 로직들이 잘 수행될 수 있도록 DB, http 라우터 등 외부 환경을 다루는 실제 구현이 이루어 진다.</p>
<p>본 레이어에서 도메인의 repository interface에 정의된 함수들을 실제로 구현하며, express router를 활용하여 외부 요청에 대한 라우팅을 수행한다.</p>
<p>또한 본 레이어에는 middleware, auth guard, errorHandler 처럼 도메인에 접근하기 전에 전처리되거나 비즈니스 로직 이후 클라이언트에게 반환할 반환값에 대한 후처리 로직이 들어간다.</p>
<p>auth guard 는 decorator 를 사용하여 제작되었다.</p>
<h2><span id="branching-model">Branching Model</span></h2><p>모든 작업 내용은 feature/[브랜치 명] 에서 작업하고, dev 서버에 배포하기 위한 버전을 develop 브랜치에 푸시한다.</p>
<p>Release 브랜치에서 develop 브랜치를 pull 하면서 코드리뷰를 진행하고 모든 코드리뷰 사항이 반영되면 release 브랜치에 머지된다.</p>
<p>release 브랜치에서 스프린트 및 일정관리, 테스트 작업을 진행하며 안정화되면 master 브랜치로 push 하고 서비스 배포한다.</p>
<p>-   Master: 실제 서비스 배포를 위한 브랜치</p>
<p>-   Release: 개발 진행의 경과가 되는 브랜치로 QA 및 일정관리의 지표가 된다.</p>
<p>-   Develop: 각 개발자들이 실시간으로 머지하는 브랜치로 테스트 서버의 소스코드가 보관된다.</p>
<p>-   Feature: 각 개발자들이 임의로 자신들의 작업량을 작업한다.</p>
<h2><span id="input-validation">Input validation</span></h2><p>본 프로젝트에서는 클라이언트의 요청값을 검증함에 있어 모든 요청의 형태를 DTO 형태로 정의하고 해당 DTO 에 값을 넣기 전에 <code>Joi</code> 라이브러리를 사용하여 요청값에 대한 검증을 수행한다.</p>
<h2><span id="tsconfig-setting">tsconfig setting</span></h2><p>각 파일에서 다른 파일을 import 함에 있어서 보다 가독성을 높이기 위해 @domain과 같이 태그를 하여 손쉽게 import를 할 수 있습니다.</p>
<p>tsconfig.json 파일의 예</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">"paths"</span>: &#123;</span><br><span class="line"></span><br><span class="line">            <span class="attr">"@domain/"</span>: [<span class="string">"server/domain/"</span>]</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위처럼 옵션을 설정하면 복잡한 filepath 대신 위의 태그네임을 통해 import 할 수 있습니다.</p>
<p>이때 위의 태그네임이 잘 반영이 되지 않는 경우가 있는데, 이는 웹팩에서 트랜스파일링을 하는 과정에서 webpack.config.js 세팅을 바꾸어 줌으로써 해결이 가능합니다.</p>
<p>태그 네이밍을 하기 위해서 tsconfig-paths-webpack-plugin 을 사용하는데 해당 플러그인은 다음과 같이</p>
<p>루트 plugin이 아닌 resolve 내의 plugin 내에 설정되어야 합니다.</p>
<p>webpack.config.js의 예</p>
<p>\<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">​    resolve: &#123;</span><br><span class="line"></span><br><span class="line">​        plugins: [</span><br><span class="line"></span><br><span class="line">​            <span class="keyword">new</span> TsconfigPathsPlugin(&#123;</span><br><span class="line"></span><br><span class="line">​                configFile: <span class="string">'./tsconfig.json'</span> <span class="comment">// setup tsconfig path</span></span><br><span class="line"></span><br><span class="line">​            &#125;)</span><br><span class="line"></span><br><span class="line">​        ];</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">\</span><br></pre></td></tr></table></figure></p>
<h3><span id="author">Author</span></h3><p><a href="https://github.com/frontalnh" target="_blank" rel="noopener">frontalnh(Namhoon Lee)</a></p>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/03/16/nuxt-js-시작하기/" itemprop="url">
                Nuxt.js 시작하기
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-03-16T09:14:59.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/next/">next</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                13 minutes read (About 1997 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <!-- toc -->
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#next-cli">Next CLI</a></li>
<li><a href="#vuex">Vuex</a></li>
<li><a href="#global-css">Global CSS</a><ul>
<li><a href="#setup-vuetify">Setup Vuetify</a></li>
</ul>
</li>
<li><a href="#nuxt-에서-axios-사용하기">Nuxt 에서 axios 사용하기</a><ul>
<li><a href="#기본-사용법">기본 사용법</a></li>
<li><a href="#http-helper-plugin-적용">http helper plugin 적용</a></li>
</ul>
</li>
<li><a href="#plugin-사용하기">Plugin 사용하기</a><ul>
<li><a href="#플러그인-만들기">플러그인 만들기</a></li>
<li><a href="#플러그인-등록하기">플러그인 등록하기</a></li>
<li><a href="#vue-instance-contextk-store-에서-사용가능하게-등록하기">Vue instance, Contextk, Store 에서 사용가능하게 등록하기</a></li>
</ul>
</li>
<li><a href="#reverse-proxy">Reverse proxy</a></li>
<li><a href="#global-modal">Global Modal</a></li>
<li><a href="#environment-variables">Environment variables</a></li>
<li><a href="#problem-solving">Problem solving</a><ul>
<li><a href="#layout-사용하기">layout 사용하기</a></li>
<li><a href="#unexpected-token-import">Unexpected token import</a></li>
<li><a href="#cannot-find-module">cannot find module</a></li>
<li><a href="#query-string-nested-object">Query string nested object</a></li>
<li><a href="#custom-component-의-click-이벤트를-자식-요소로-넘기는-법">Custom Component 의 click 이벤트를 자식 요소로 넘기는 법</a></li>
<li><a href="#다른-vuex-모듈에서-다른-vuex-모듈에-있는-액션을-호출하는-법">다른 vuex 모듈에서 다른 vuex 모듈에 있는 액션을 호출하는 법</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h2><span id="installation">Installation</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vue init nuxt-community/typescript-template [프로젝트 명];</span><br><span class="line"></span><br><span class="line">yarn add nuxt-property-decorator &amp;&amp; <span class="comment"># property decorator installation</span></span><br><span class="line">yarn add tsconfig-paths-webpack-plugin &amp;&amp;<span class="comment"># webpack 에서 typescript 를 사용하기 위한 세팅</span></span><br><span class="line">yarn add ts-loader &amp;&amp; <span class="comment"># typescript 사용을 위한 ts-loader 설치</span></span><br><span class="line">yarn add vuex-class &amp;&amp; <span class="comment"># Vuex 를 class 타입으로 사용하기 위해 설치</span></span><br><span class="line">yarn add nuxt-sass-resources-loader &amp;&amp; <span class="comment"># For using sass</span></span><br><span class="line">yarn add sass-loader <span class="comment"># for using sass</span></span><br></pre></td></tr></table></figure>
<p>타입스크립트를 트랜스파일링 하기 위해 webpack configuration을 바꾸어 주어야 한다.</p>
<p>이는 nuxt.config.js 에서 webpack configuration 을 overriding 함으로써 구현한다.</p>
<p>nuxt.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">build: &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   ** You can extend webpack config here</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  extend(config, ctx) &#123;</span><br><span class="line">    config.resolve.extensions.push(<span class="string">'.ts'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tsLoader = &#123;</span><br><span class="line">      loader: <span class="string">'ts-loader'</span>,</span><br><span class="line">      options: &#123; <span class="attr">appendTsSuffixTo</span>: [<span class="regexp">/\.vue$/</span>], <span class="attr">transpileOnly</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      exclude: [<span class="regexp">/vendor/</span>, /\.nuxt/]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    config.module.rules.push(&#123; <span class="attr">test</span>: <span class="regexp">/.tsx?$/</span>, ...tsLoader &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> rule <span class="keyword">of</span> config.module.rules) &#123;</span><br><span class="line">      <span class="keyword">if</span> (rule.loader === <span class="string">'vue-loader'</span>) &#123;</span><br><span class="line">        rule.options.loaders = &#123;</span><br><span class="line">          ts: tsLoader</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> plugin = <span class="keyword">new</span> TsconfigPathsPlugin(&#123;</span><br><span class="line">      configFile: <span class="string">'tsconfig.json'</span> <span class="comment">// setup tsconfig path</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    config.resolve[<span class="string">'plugins'</span>] = [plugin];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="next-cli">Next CLI</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install dependencies</span></span><br><span class="line"></span><br><span class="line">$ npm install <span class="comment"># Or yarn install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># serve with hot reload at localhost:3000</span></span><br><span class="line"></span><br><span class="line">$ npm run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># build for production and launch server</span></span><br><span class="line"></span><br><span class="line">$ npm run build</span><br><span class="line"></span><br><span class="line">$ npm start</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate static project</span></span><br><span class="line"></span><br><span class="line">$ npm run generate</span><br></pre></td></tr></table></figure>
<h2><span id="vuex">Vuex</span></h2><p>store 디렉토리는 어플리케이션에서 사용하는 도메인 객체들의 저장소이다.</p>
<p>초기 프로젝트는 Vuex 가 disable 된 상태이나 다음과 같이 store/index.js 파일을 작성하면, Vuex 를 사용할 수 있다.</p>
<p>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">      counter: <span class="number">0</span></span><br><span class="line">    &#125;),</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      increment(state) &#123;</span><br><span class="line">        state.counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore;</span><br></pre></td></tr></table></figure>
<p>Vuex state 의 경우 nested 된 object 의 경우 내부 값만 바뀌면 store 가 업데이트 되지 않는 현상이 있다.</p>
<p>이를 위한 해결법으로 state.prop[key] ={} 와 같은 연산이 있다면 이를 <code>state.prop={[key]:{}}</code> 와 같이 수정하는 트릭을 쓸 수 있다.</p>
<h2><span id="global-css">Global CSS</span></h2><p>nuxt.config.js 에서 head 에 추가한다.</p>
<h3><span id="setup-vuetify">Setup Vuetify</span></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @nuxtjs/vuetify</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuetify <span class="keyword">from</span> <span class="string">'vuetify'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuetify);</span><br><span class="line"><span class="keyword">import</span> <span class="string">'vuetify/dist/vuetify.min.css'</span>; <span class="comment">// Ensure you are using css-loader</span></span><br></pre></td></tr></table></figure>
<p>nuxt.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  modules: [</span><br><span class="line">    <span class="string">'@nuxtjs/vuetify'</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Vuetify options</span></span><br><span class="line">  vuetify: &#123;</span><br><span class="line">    <span class="comment">//  theme: &#123; &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="nuxt-에서-axios-사용하기">Nuxt 에서 axios 사용하기</span></h2><h3><span id="기본-사용법">기본 사용법</span></h3><p>Nuxt 에서는 기본적으로 다음과 같은 방법을 통해 axios 모듈을 사용할 수 있다.</p>
<p>여기서, 왜 그냥 axios 를 동적으로 import 해서 사용하지 않고 nuxt 가 제공하는 axios 를 사용해야 하는지 궁금할 수 있다.</p>
<p>바로 그 이유는, nuxt 는 기본적으로 server redering 방식으로 동작하기 때문에, browser cookie 와 jwt 토큰 등의 중앙적인 데이터에 접근하기가 힘들기 때문이다.</p>
<p>nuxt 가 제공하는 axios 는 withCredential 등을 통해 간편하게 cookie 데이터에 접근할 수 있는 장점이 있다.</p>
<p>axios 설치</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @nuxtjs/axios</span><br></pre></td></tr></table></figure>
<p>axios 모듈 등록</p>
<p>nuxt.config.ts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  modules: [</span><br><span class="line">    <span class="string">'@nuxtjs/axios'</span>,</span><br><span class="line">  ],</span><br><span class="line">  axios: &#123;</span><br><span class="line">    <span class="comment">// proxyHeaders: false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이를 통해 각 component 의 <code>this.$axios</code> 와 <code>context 의 $axios</code> 를 통해 axios를 사용할 수 있다.</p>
<p>하지만, 여기서는 범용 logger 혹은 http request 에 있어서 일관된 에러 핸들링 등을 할 수 없기 때문에 이 함수를 사용하는 httpHelper 플러그인을 구현하여 이를 가능하도록 한다.</p>
<h3><span id="http-helper-plugin-적용">http helper plugin 적용</span></h3><p>여기서 httpHelper의 경우 get, post, put, delete 등의 메소드를 wrapping 하는 다양한 함수들이 존재하며 여기서는 구현을 생략하겠다.</p>
<p>중요한 점은 이런 HttpHelper 클래스가 plugin 에서 <code>$axios</code> 를 주입받아 새로운 메소드를 구현하며, 이를 <code>inject 함수를 통해 vue instance, store, context 에 바인딩 하여 어느 곳에서나 사용 가능하게 해준다는 것이다.</code></p>
<p>plugins/httpHelper.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HttpHelper &#125; <span class="keyword">from</span> <span class="string">'utils/httpHelper'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">context, inject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; $axios &#125; = context;</span><br><span class="line">  <span class="keyword">let</span> httpHelper = <span class="keyword">new</span> HttpHelper($axios);</span><br><span class="line">  context.$httpHelper = httpHelper;</span><br><span class="line"></span><br><span class="line">  inject(<span class="string">'httpHelper'</span>, httpHelper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="plugin-사용하기">Plugin 사용하기</span></h2><p>Vue.js 의 자체 기능 뿐 아니라 다양한 외부 라이브러리 혹은 사용자의 external util function 등을 활용하기 위해서 nuxt 는 plugin 이라는 기능을 제공한다.</p>
<p>이러한 plugin 을 통해서 사용자는 사용하고자 하는 함수 혹은 instance 를 vue root application 혹은 context 에 binding 할 수 있다.</p>
<h3><span id="플러그인-만들기">플러그인 만들기</span></h3><p>plugins/sample.ts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (context, inject) =&gt; &#123;</span><br><span class="line">  context.$sample = <span class="function"><span class="params">a</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3><span id="플러그인-등록하기">플러그인 등록하기</span></h3><p>플러그인을 사용하기 위해 nuxt configuration 에 등록시켜 주어야 한다.<br>nuxt.config.ts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [<span class="string">'~/plugins/sample.ts'</span>]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3><span id="vue-instance-contextk-store-에서-사용가능하게-등록하기">Vue instance, Contextk, Store 에서 사용가능하게 등록하기</span></h3><p>기본적으로 plugin 을 등록하면 오직 context 혹은 vue instance 내에서만 사용 가능하다.<br>하지만 store 혹은 여러 곳에서 이 함수 혹은 인스턴스에 접근하고자 한다면 <code>inject</code> 함수를 이용하여 전역에서 사용가능하게 등록시켜 주어야 한다.</p>
<p>아래처럼 <code>&#39;sample&#39;</code> 과 같이 <code>$</code> 기호를 생략하고 등록해 주면 <code>$sample</code> 과 같이 변형되어 바인딩 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (context, inject) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sample = <span class="function"><span class="params">a</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> sample2 = &#123;</span><br><span class="line">    b: <span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  inject(<span class="string">'sample'</span>, sample);</span><br><span class="line">  inject(<span class="string">'sample2'</span>, sample2);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>이를 통해 context, Vue 인스턴스 내에서의 this 등 어디에서는 이곳에 접근할 수 있게 된다.</code></p>
<h2><span id="reverse-proxy">Reverse proxy</span></h2><p>클라이언트가 서버를 호출하는 경우 <code>cors(cross origin resource sharing</code> 문제로 브라우저 내에 렌더링 된 페이지를 준 호스트가 아닌 다른 곳으로의 요청은 기본적으로 막혀있다.</p>
<p>사실 이는 nuxt.js 뿐만이 아니라 대부분의 웹 어플리케이션 배포 과정에서 나타나는 문제인데, nuxt.js 에서는 그 해결과정이 조금 다르기 때문에 작성한다.</p>
<p>다른 어플리케이션 배포과정의 경우 일반적으로 nginx 와 같은 web server 를 사용하여 reverse proxy 를 통해 클라이언트 내의 서버 요청 url 을 같은 호스트로 설정하고, 같은 호스트로 오는 요청의 url 을 분석하여 같은 호스트 내의 다른 포트로 리다이렉팅 시켜주는 등의 해결법을 제시하지만, nuxt.js 의 경우 server rendering 프레임워크로 독자적으로 hosing 을 하는 만큼, 자체적으로 reverse proxy 를 제공하며, <code>nuxt.config.js</code> 파일에 다음과 같이 <code>reverse proxy</code> 설정을 주어 해결할 수 있다.</p>
<p>nuxt.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serverUrl = <span class="string">"localhost:3002"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    <span class="string">'/api/'</span>: serverUrl</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="global-modal">Global Modal</span></h2><p>전역으로 alert와 dialog를 사용하기 위해 layout 레이어에서 해당 모듈을 구현하였으며, 이는 page store 를 통해 접근이 가능하다.</p>
<h2><span id="environment-variables">Environment variables</span></h2><p>node.js 서버와는 달리 nuxt 의 경우는 동작환경이 브라우저 이므로, 서버에서 하듯이 <code>process.env</code> 와 같이 환경변수에 접근해도 브라우저의 환경변수이기 때문에 접근이 되지 않는다. 이는 매우 기본적인 사실이지만 서버렌더링을 하는 과정에서 혼동될 수 있다.</p>
<p>즉, nuxt.js 에서 process.env 를 사용한다면, 이는 빌드시점에 주입되어야 할 것이다.</p>
<h2><span id="problem-solving">Problem solving</span></h2><h4><span id="layout-사용하기">layout 사용하기</span></h4><p>vue component class 를 사용함에 있어 layout 옵션이 설정되지 않았다면 다음 코드를 index.d.ts 에 추가한다.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> 'vue/types/options' &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">interface</span> ComponentOptions&lt;V <span class="keyword">extends</span> Vue&gt; &#123;</span><br><span class="line"></span><br><span class="line">    layout?: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="unexpected-token-import">Unexpected token import</span></h4><p>모든 기능이 정산인데 갑자기 Unexpected token import 에러가 났다.</p>
<p>이 경우 최종 문제의 원인은</p>
<p>nuxt.config.js에서 modules 에 bootstrap-vue 를 import 함에 있어 <code>bootstrap-vue/nuxt</code> 가 아니라 <code>@nuxtjs/bootstrap-vue</code> 를 import 하여 생기는 문제였다.</p>
<p>bootstrap-vue 공식 홈페이지에도 <code>bootstrap-vue/nuxt</code> 를 import 하라고 하고 있는데, 이를 매우 주의하여야 한다.</p>
<h4><span id="cannot-find-module">cannot find module</span></h4><p>nuxt property decorator 를 사용할때</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">components</span>:&#123;&#125;&#125; 속성을 추가하지 않으면 모듈을 찾지 못하는 문제가 생긴다.</span><br></pre></td></tr></table></figure>
<h4><span id="query-string-nested-object">Query string nested object</span></h4><p>기존에는 querystring 라이브러리를 사용하여 nested object 를 처리하지 못하였으나, qs 라이브러리를 사용하면 해결 가능하다.</p>
<h4><span id="custom-component-의-click-이벤트를-자식-요소로-넘기는-법">Custom Component 의 click 이벤트를 자식 요소로 넘기는 법</span></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@click.native</span><br></pre></td></tr></table></figure>
<h4><span id="다른-vuex-모듈에서-다른-vuex-모듈에-있는-액션을-호출하는-법">다른 vuex 모듈에서 다른 vuex 모듈에 있는 액션을 호출하는 법</span></h4>
                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/03/12/javascript-cookbook/" itemprop="url">
                Javascript Cookbook
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-03-12T03:43:17.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
                
                    <span class="column is-narrow">
                        
                            
                                8 minutes read (About 1229 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <!--toc-->
<h2><span id="javascript-cookbook">Javascript Cookbook</span></h2><h3><span id="object">Object</span></h3><h4><span id="assign">assign()</span></h4><p>assign 함수는 특정 객체의 값을 복사하는 함수입니다. assign 함수를 통해 두 개 이상의 객체를 병합하는 등의 작업을 수행 가능합니다.</p>
<p>assign 함수는 아래와 같이 사용되며 대상 객체를 반환합니다.</p>
<p>example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.assign(target, ...source)</span><br></pre></td></tr></table></figure>
<p><strong>객체 복사하기</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> target = <span class="built_in">Object</span>.assign(&#123;&#125;, source);</span><br></pre></td></tr></table></figure>
<p>위와 같이 Object.assign은 객체를 복사하는 데 사용될 수 있으며, {} 처럼 빈 객체를 넣고 반환값을 받음으로써 빈 객체에 source 가 되는 object를 복사할 수 있습니다.</p>
<p><strong>객체 병합하기</strong></p>
<p>assign 함수를 통해 객체를 병합 할 수 있습니다. 가령 a, b 객체가 있고 각각의 키값을 하나로 병합하고 싶다면 다음과 같이 수행 할 수 있습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">a</span>:<span class="number">1</span>, <span class="attr">c</span>:<span class="number">4</span>, <span class="attr">d</span>:<span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> target = <span class="built_in">Object</span>.assign(&#123;&#125;, obj1, obj2);</span><br></pre></td></tr></table></figure>
<p>이처럼 만약 동일한 key를 가졌다면 뒤에 오는 source의 key, value 들로 덮어씌워지는 방식으로 복사될 것입니다.</p>
<h4><span id="keys">keys()</span></h4><h4><span id="entries">entries()</span></h4><p>entries 함수는 object의 키들을 열거가능한 [key, value] 쌍을 리턴해 주며, 다음과 같이 사용됩니다.</p>
<p>example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> entries = <span class="built_in">Object</span>.entries(obj);</span><br><span class="line"><span class="comment">// [["a", 1],["b", 2],["c", 3]]</span></span><br></pre></td></tr></table></figure>
<p>객체 내의 다양한 키들을 순환하는 로직을 구현 하는 경우 이는 매우 효과적이며 다음과 같이 사용됩니다.</p>
<p><strong>exmaple</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> entries = <span class="built_in">Object</span>.entries(obj);</span><br><span class="line">entries.foreach(<span class="function">(<span class="params">key, value</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// do some stuff</span></span><br><span class="line">  <span class="built_in">console</span>.log(key, value);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3><span id="map">Map</span></h3><p>js에서 Map 이란 일종의 key 와 value의 쌍으로 흔히 object와 비슷한 역할을 수행하지만, object와 달리 어떤 종류의 값도 저장할 수 있는 장점이 있으며, 흔히 대량의 자료가 저장되는 경우 object에 비해 훨씬 좋은 성능을 보인다.</p>
<p>이번 포스트에서는 Map 이 가진 다양한 함수들과 이에 대한 활용법에 대해 알아보도록 한다.</p>
<p>example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>([iterable]) <span class="comment">//key, value pair</span></span><br></pre></td></tr></table></figure>
<h4><span id="set">set</span></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[a, <span class="number">1</span>], [b, <span class="number">2</span>]]);</span><br><span class="line">map.set(c, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<h4><span id="get">get</span></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[a, <span class="number">1</span>], [b, <span class="number">2</span>]]);</span><br><span class="line">map.get(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h4><span id="deletekey">delete(key)</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var exampleMap = new Map([a, 1], [b, 2]);</span><br><span class="line">exampleMap.delete(a);</span><br></pre></td></tr></table></figure>
<h4><span id="foreach">foreach</span></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> example = <span class="keyword">new</span> <span class="built_in">Map</span>([a, <span class="number">1</span>], [b, <span class="number">2</span>]);</span><br><span class="line">example.foreach((value, key)&#123;</span><br><span class="line">  <span class="comment">// do some stuff here.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3><span id="array">Array</span></h3><h4><span id="sort">sort()</span></h4><p>array의 sort는 배열을 정렬하기 위한 아주 좋은 method 입니다.</p>
<p>sort는 뒤에 오는 콜백함수를 계속 실행하여 callback(a, b)의 값이 0보다 작은 경우 a를 앞으로 보내고, 0보다 큰 경우 a를 뒤로 보내는 방식으로 동작합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/* 정상 동작 */</span><br><span class="line">score.sort(function(a, b) &#123; // 오름차순</span><br><span class="line">    return a - b;</span><br><span class="line">    // 1, 2, 3, 4, 10, 11</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">score.sort(function(a, b) &#123; // 내림차순</span><br><span class="line">    return b - a;</span><br><span class="line">    // 11, 10, 4, 3, 2, 1</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">student.sort(function(a, b) &#123; // 오름차순</span><br><span class="line">    return a.name &lt; b.name ? -1 : a.name &gt; b.name ? 1 : 0;</span><br><span class="line">    // 광희, 명수, 재석, 형돈</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">student.sort(function(a, b) &#123; // 내림차순</span><br><span class="line">    return a.name &gt; b.name ? -1 : a.name &lt; b.name ? 1 : 0;</span><br><span class="line">    // 형돈, 재석, 명수, 광희</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4><span id="splice">splice()</span></h4><p>array.splice(i,1)를 통해 index i 로 부터 1개의 요소를 제거하고 제거한 자리에 값을 추가한다.</p>
<p><strong>example</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var array = [0, 1, 2, 3, 4, 5];</span><br><span class="line">array.splice(2, 1);</span><br><span class="line">//array에는 세번째 요소가 빠진 상태가 된다.</span><br><span class="line">[0, 1, 3, 4, 5]</span><br></pre></td></tr></table></figure>
<h4><span id="delete">delete</span></h4><p>특정 요소를 삭제할 때 사용한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];</span><br><span class="line">delete arr[1];</span><br></pre></td></tr></table></figure>
<h4><span id="pop">pop</span></h4><p>array를 stack으로 사용하는 경우 pop() 함수는 매우 유용하며, 가장 우측의 element를 제거한다.</p>
<p>example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let list = [1, 2, 3, 4, 5, 6, 7];</span><br><span class="line"></span><br><span class="line">console.log(&apos;original list: &apos;, list);</span><br><span class="line"></span><br><span class="line">let poped = list.pop();</span><br><span class="line">console.log(&apos;poped item: &apos;, poped);</span><br><span class="line">console.log(&apos;list after pop() executed: &apos;, list);</span><br></pre></td></tr></table></figure>
<h4><span id="push">Push</span></h4><p>리스트에 특정 아이템을 추가하고 추가된 이후에 총 아이템의 갯수를 반환한다.</p>
<p>이 함수는 원래의 리스트를 변형한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'original list: '</span>, list);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = list.push(<span class="string">'pushed item'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Total item count after push() executed: '</span>, count);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'list after push() executed: '</span>, list);</span><br></pre></td></tr></table></figure>
<h4><span id="shift">shift</span></h4><p>shift는 주로 que의 구현에 많이 사용되며, 제일 앞의 element를 제거하고 반환해 준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(&apos;original list: &apos;, list);</span><br><span class="line"></span><br><span class="line">let shifted = list.shift();</span><br><span class="line">console.log(&apos;shifted item: &apos;, shifted);</span><br><span class="line">console.log(&apos;list after shift() executed: &apos;, list);</span><br></pre></td></tr></table></figure>
<h4><span id="unshift">unshift()</span></h4><p>제일 앞쪽에 밀어 넣는다.</p>
<p><strong>example</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];</span><br><span class="line">fruits.unshift(&quot;Lemon&quot;);    // Adds a new element &quot;Lemon&quot; to fruits</span><br></pre></td></tr></table></figure>
<h4><span id="foreachgt">foreach(()=&gt;{})</span></h4><p>모든 어레이값에 대해 연산을 수행하는 함수이며 다음과 같이 사용된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr.foreach(<span class="function">(<span class="params">element, index, array</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(element);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4><span id="reduce">reduce</span></h4><p>reduce는 array의 모든 값에 대해 계속해서 callback함수를 실행시키는 함수이며 다음과 같은 용도로 사용합니다.</p>
<p><strong>syntax</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">accumulator, currentValue, currentIndex, array</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// do some stuff here.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>여기서 첫번째 인자인 accumulator는 계속해서 다음 callback의 인자로 전달되는 값이며 어떤 변환을 하더라도 해당 변환 내용이 다음으로 전달되며, currentValue는 현재 값을 나타냅니다.</p>
<p><strong>배열에서 가장 큰 값을 구하기</strong></p>
<p>accumulator를 통해 계속 앞의 return 값을 받아와 비교하면서 가장 큰 값을 구할 수 있습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> max = arr.reduce(<span class="function">(<span class="params">before, current</span>)=&gt;</span></span><br><span class="line">  <span class="keyword">return</span> before&lt;current ? current : before</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/03/03/how-to-start-a-startup/" itemprop="url">
                How to start a startup
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-03-03T02:43:58.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
                
                    <span class="column is-narrow">
                        
                            
                                7 minutes read (About 1021 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <p>제품을 만들고 고객과 대화를 하는 것 외에는 하지마라.</p>
<h2><span id="사업-계획의-수립">사업 계획의 수립</span></h2><p>일단 아이디어가 어느정도 구체화 되었다면, 해당 아이디어에 대한 시장 가능성과 실제 아이디어의 실행을 위한 방법들을 수립해야 하며 크게 <strong>상황분석 =&gt; 전략 수립 =&gt; 전략 실행</strong> 의 흐름으로 이어진다.</p>
<h4><span id="시장과-경쟁자에-대한-명확한-분석을-통해-독보적인-차별점을-도출하자">시장과 경쟁자에 대한 명확한 분석을 통해 독보적인 차별점을 도출하자</span></h4><p>여기서 가장 먼저 해야 할 일은 바로 기업의 내부적 정보와 외부적 정보를 수집하는 것이다. 가령 우리 스타트업이 가장 잘하는 것은 무엇인지 또 할 수 있는것과 할 수 없는 것은 무엇인지 우리가 다른 스타트업에 비해 뛰어나게 잘하는 것과 부족한 것이 무엇인지를 냉철하게 판단해야 한다. 이를 위해서는 하고자 하는 비즈니스에 끊임없는 고민이 필요하며, 시장에 어떤 경쟁자들이 있고, 그들의 강점과 약점이 무엇인지를 명확하게 이해하는 것이 중요하다. <strong>대부분의 성공한 스타트업들은 이미 시장에 자리잡은 경쟁자가 있음에도 불구하고 명확한 차별점을 내세우고 기존 시장에 참여한 기업들이다</strong> 즉, 시장을 분석하고 내가 가장 잘 하는 강점을 무기로 삼아 시정을 침투해야하며, 이를 위한 정보의 수집은 매우 중요하다.</p>
<p>가장 간단하게는 다음과 같은 질문을 해볼 수 있다.</p>
<ol>
<li>나와 우리 팀이 가장 잘하는 것은 무엇이고 그 근거는 무엇인가?</li>
<li>이미 시장에 있는 경쟁자들이 잘하는 것은 무엇이고 우리가 그들보자 나은점이 무엇인가?</li>
<li>시장의 고객들은 기존 경쟁자들의 어떤 차별점에 반응하고, 그들의 체워지지 않은 니즈는 무엇인가?</li>
</ol>
<h4><span id="현상분석">현상분석</span></h4><p>다음으로 조사해야할 부분은 시장의 상황과 트렌드 그리고 다양한 이슈들을 말미암아 스타트업의 성공가능성과 실패 가능성을 점치는 것이다. 가령 커피를 판다고 하면 시장에 어떤 커피들이 인기를 끌고 있으며, 전체 커피 시장과 고객의 니즈는 향후 어떤 방향으로 나아갈 것인가에 대한 분석이 이것이다.</p>
<p>고객의 선호와 취향이 변모해 나가는 트렌드를 이해하고 하고자 하는 비즈니스가 그 흐름에 부합하는 지를 숙고하자.</p>
<h4><span id="비즈니스-전략의-수립">비즈니스 전략의 수립</span></h4><p>내가 시장의 다른 경쟁자들에 비해 무엇을 잘하고, 또 경쟁력을 가지지 못하는 약점을 명확하게 인지하였다면, 기업의 모든 자원을 기업이 가진 강점에 쏟아부어야 한다. 가량 다른 기업이 이미 잘하고 있고, 그들이 가진 강점의 나와 우리 팀이 아무런 근거 없이 ‘더 잘할 수 있다’ 라는 마인드 셋으로 전략을 세우는 것은 많은 스타트업이 하는 실수이다. </p>
<p>여기서 세운 전략을 기업을 운영함에 있어 잊지 말아야 할 본질이고, 나의 모든 자원을 합리적으로 분배할 근거가 되기에 이 내용을 바탕으로 말미암아 기업의 사명 선언문과  단기적 프로젝트의 목표를 규정한다.</p>
<h4><span id="구체적인-실행계획-수립">구체적인 실행계획 수립</span></h4><p>사업의 큰 정책적 방안을 수립하였다면 단기적인 실행 계획을 세운다.</p>
<p>구체적인 실행의 일정부터 예산이 허락하는 범위 내에서 짜임새 있는 예산안을 수립한다.</p>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/03/01/how-to-write-a-pitch-email/" itemprop="url">
                How To Write A Pitch Email
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-03-01T04:48:46.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/email/">email</a><span>></span><a class="article-category-link" href="/categories/email/pitch/">pitch</a><span>></span><a class="article-category-link" href="/categories/email/pitch/sales/">sales</a><span>></span><a class="article-category-link" href="/categories/email/pitch/sales/business/">business</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                5 minutes read (About 779 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <h4><span id="no-cold-email">no cold email</span></h4><p>가급적으로 cold 이메일을 피하는 것은 매우 중요하다.</p>
<p>이메일 피칭은 일종의 sales 이며, 수신자는 이를 즉시 인지하게 된다.</p>
<p>때문에 부정적인 이미지를 주지 않기 위해 warm introduction 을 하는 것이 매우 중요하다.</p>
<p>가장 많이 하는 실수중 하나는 여러 명의.사람들에게 무작위 cold email 을 보내는 것이다. 이는 personalized 되지도 않았고 무작위로 copy and paste 되기 일쑤이다.</p>
<p>이는 전혀 효과적이지 않다.</p>
<p>수신자는 당신의 프로모션에 관심이 없고, 당신을 만나야 할 이유가 명확하게 5초 이내에 설득되지 않으면 당신의 이메일은 쓰레기통으로 들어갈 것이다.</p>
<h4><span id="주제문단이-가장-가장-가장-가장-중요하다">주제문단이 가장 가장 가장 가장 중요하다.</span></h4><p>다른 수많은 이메일과 독보적인 차이를 보이지 못하면 바로 삭제될 것이다</p>
<h4><span id="기본-포맷">기본 포맷</span></h4><p>첫문단에서는 간단한 인사를 건내고 그 사람의 신상정보에 대해 아는 것이 있다면 작성해라. SNS 나 링크드인에서 찾은 사람이 있다면 언급해주자.</p>
<p>두번째 문단에서는 제품에 대한 피칭을 진행한다.3~4 줄로</p>
<p>세번째 문단에서는 해당 제품이 해당 기업에 어떤 가치를 제공할지에 대해 이야기 하라 어떤 기회를 가져다주고 해당 기업을 조사하여 personalize 해야한다. 만약 가격을 제시한다면 이곳이 적당하다.</p>
<p>마지막 문단에서는 인사를 하고 전화나 이메일로 컨택을 요청한다.</p>
<h4><span id="제일-중요한-것은-진정성이다">제일 중요한 것은 진정성이다.</span></h4><p>피칭 메일을 작성하는 사람의 머릿속에 드는 가장 큰 생각은 바로 어떻게 내 제품을 사게 만들것인가이다. 하지만, 진정으로 수신자의 마음을 움직이기 위해서는 진정으로 그 사람을 이해하고 우리가 그들에게 제공할 수 있는 가치가 무엇인지를 계속 고민해야 한다.</p>
<p>만약, 메일을 쓰는 내내 그들의 입맛ㅇ르 당기게 하고, 제품만 팔고자 하는 마음을 가지고 있다면, 정말 진정성 있는 제안서가 나오기 힘들다. 특히 이런저런 이메일 피칭법을 보고 다른 피칭 메일을 참조하면서 정형화된 형식의 메일만이 나올뿐이며, 그 메일은 아마도 수신자의 마음을 움직이지는 못할 것이다. </p>
<p>피칭을 하는 과정은 내 제품을 이해하고 받는 이에게 내가 어떤 가치를 제공할 수 있는지를 고민하는 과정이지, 내 판매고를 올리기 위한 과정이 아니다.</p>
<p>내가 가진 제품의 확실한 경쟁력을 계속해서 제고하면서 진정성 있는 메일을 작성해야 할 것이다.</p>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/02/28/getting-started-with-truffle/" itemprop="url">
                Getting started with truffle
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-28T07:23:50.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
                
                    <span class="column is-narrow">
                        
                            
                                a few seconds read (About 7 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g truffle</span><br><span class="line">truffle init</span><br></pre></td></tr></table></figure>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/02/28/signing-and-verifying-in-ethereum/" itemprop="url">
                Signing and verifying in ethereum
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-28T02:31:29.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/ethereum/">ethereum</a><span>></span><a class="article-category-link" href="/categories/ethereum/blockchain/">blockchain</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                15 minutes read (About 2311 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <h1><span id="signing-and-verifying-in-ethereum">Signing and verifying in ethereum</span></h1><p>이더리움에서 eth 를 송금하거나 스마트 컨트랙을 부르는 등의 transaction 을 일으키기 위해서는 signing 이 필요하며, 블록체인 상에서 사용자를 인증하거나 메세지의 유효성을 검증하기 위해 signing 과 validation 이 사용된다.</p>
<p>가령, Alice 가 Bob 에게 어떤 메세지를 보내는 상황을 전제해 보자. 여기서 Bob 이 메세지를 받았다면, 인터넷 네트워크에서는 누구든지 메세지를 보낼 수 있고, 나쁜 의도를 가진 다수의 사용자들이 존재하기 때문에, 진짜 그 메세지가 Alice 로 부터 온 것인지 또, 메세지의 내용이 Alice 가 보낸 그 내용이 맞는지에 대해 의문을 품을 것이다. 이 때문에 블록체인 에서는 signing 의 개념이 존재하며 여기서 그 유효성을 검증하고자 하는 대상을 <strong>message</strong> 라고 한다.</p>
<p>그렇다면 이제 어떻게 <strong>signging</strong> 과 <strong>validation</strong> 이 진행되는 지를 알아보자. </p>
<p>먼저 위 사례에서 Alice 는 자신의 <strong>Private Key</strong> 로 해당 메세지에 서명을 한다. 이더리움에서 제공하는 web3 를 통해 다음과 같은 간략한 명령을 통해 이런 <strong>signing</strong> 이 진행되게 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.accounts.sign(message, privateKey);</span><br></pre></td></tr></table></figure>
<p> 위 에서 message 는 유효성을 검증하기 위한 메세지로 <code>String</code> 타입이다.</p>
<p>위 과정을 거치면 사용자가 서명을 한 메세지를 의미하는 <strong>Signature Object</strong> 가 나오게 되는데 그 형식은 다음과 같다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    message: 'Some data',</span><br><span class="line">    messageHash: '0x1da44b586eb0729ff70a73c326926f6ed5a25f5b056e7f47fbc6e58d86871655',</span><br><span class="line">    v: '0x1c',</span><br><span class="line">    r: '0xb91467e570a6466aa9e9876cbcd013baba02900b8979d43fe208a4a4f339f5fd',</span><br><span class="line">    s: '0x6007e74cd82e037b800186422fc2da167c747ef045e5d18a5f5d4300f8e1a029',</span><br><span class="line">    signature: '0xb91467e570a6466aa9e9876cbcd013baba02900b8979d43fe208a4a4f339f\</span><br><span class="line">    	5fd6007e74cd82e037b800186422fc2da167c747ef045e5d18a5f5d4300f8e1a0291c'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위에서 알 수 있듯이 <strong>Signature</strong> 에는 사용자의 원래 메세지 뿐만 아니라 <strong>messageHash</strong> 라는 <code>&quot;\x19Ethereum Signed Message:\n&quot; + message.length + message</code> 의 양식으로 포맷팅된 후 keccak256(SHA3) 으로 해쉬된 해시값을 비롯하여 signature 를 구성하는 v, r, s 와 실제 서명인 <strong>Signature</strong> 가 포함된다. 여기서 r 과 s 는 각각 <strong>Signature의 첫 32byte 와 뒤 32byte 를 나타낸다.</strong></p>
<p>* <strong>위의 MessageHash</strong> 는 web3 가 제공하는 <strong>hashMessage(message)</strong> 함수 호출을 통해서도 얻을 수 있다.</p>
<p>위처럼 sign 을 완료했다면, 해당 <strong>Signature</strong> 를 받은 사용자는 다음과 같은 <strong>recover</strong> 함수 호출을 통해 올바른 사용자인지를 판별 할 수 있다.</p>
<p>example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.accounts.recover(signatureObject);</span><br><span class="line">web3.eth.accounts.recover(message, signature [, preFixed]);</span><br><span class="line">web3.eth.accounts.recover(message, v, r, s [, preFixed]);</span><br><span class="line"></span><br><span class="line">web3.eth.accounts.recover(&#123;</span><br><span class="line">    messageHash: <span class="string">'0x1da44b586eb0729ff70a73c326926f6ed5a25f5b056e7f47fbc6e58d86871655'</span>,</span><br><span class="line">    v: <span class="string">'0x1c'</span>,</span><br><span class="line">    r: <span class="string">'0xb91467e570a6466aa9e9876cbcd013baba02900b8979d43fe208a4a4f339f5fd'</span>,</span><br><span class="line">    s: <span class="string">'0x6007e74cd82e037b800186422fc2da167c747ef045e5d18a5f5d4300f8e1a029'</span></span><br><span class="line">&#125;)</span><br><span class="line">&gt; <span class="string">"0x2c7536E3605D9C16a7a3D7b1898e529396a65c23"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// message, signature</span></span><br><span class="line">web3.eth.accounts.recover(<span class="string">'Some data'</span>, <span class="string">'0xb91467e570a6466aa9e9876cbcd013baba02900b8979d43fe208a4a4f339f5fd6007e74cd82e037b800186422fc2da167c747ef045e5d18a5f5d4300f8e1a0291c'</span>);</span><br><span class="line">&gt; <span class="string">"0x2c7536E3605D9C16a7a3D7b1898e529396a65c23"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// message, v, r, s</span></span><br><span class="line">web3.eth.accounts.recover(<span class="string">'Some data'</span>, <span class="string">'0x1c'</span>, <span class="string">'0xb91467e570a6466aa9e9876cbcd013baba02900b8979d43fe208a4a4f339f5fd'</span>, <span class="string">'0x6007e74cd82e037b800186422fc2da167c747ef045e5d18a5f5d4300f8e1a029'</span>);</span><br><span class="line">&gt; <span class="string">"0x2c7536E3605D9C16a7a3D7b1898e529396a65c23"</span></span><br></pre></td></tr></table></figure>
<h2><span id="eip712">EIP712</span></h2><h4><span id="what-is-eip712">What is EIP712</span></h4><p>EIP 712 란 <strong>Ethereum Improvement Proposals 712</strong> 의 약어로 이더리움에서 향후 지원하게 될 다양한 제안들중 하나이다. 과거 사용자가 어떤 거래를 함에 있어 sign 을 할때에는 sign 의 대상이 되는 message 가 hash 화 되어 존재하기 때문에, 서명을 하는 사용자가 자신이 서명하는 내용에 대해 잘 알기 힘든 문제가 있었으며, 가령 유사한 해시값을 가진 피싱 사이트로 유도하여 사이닝을 유도한다던가 하는 다양한 위험에 노출되어 있었다.</p>
<p>이를 해결하기 위해 안전하고 값이 변조되지 않는 해싱을 보장하면서도 readability 를 가질 수 있는 서명방법을 고안하게 되었으며 그 제안내용이 EIP712 에 제안되었다.</p>
<p>EIP712 를 통해 사용자는 자신이 서명하는 정보에 대해 명확하게 인지할 수 있게 된다고 볼 수 있다.</p>
<p>가령, 위에서처럼 <strong>일반적인 signing의 과정에서는 sign 을 요청하는 사람이 제공하는 message값(주로 hash값) 만을 보고 사용자가 sign 을 진행하지만 EIP712 에서는 json 데이터를 보고 자신이 서명하는 데이터를 명확히 알 수 있다.</strong></p>
<p>다음은 EIP712 를 통해 수행되는 서명의 방법을 나타낸다.</p>
<p>먼저 서명을 하고자 하는 데이터의 형태를 정의하는데 이러한 <code>typed structured data</code> 를 먼저 정의하는 것으로 서명이 시작된다. 아래와 같이 서명을 하고자 하는 메세지를 json 형태로 정의를 한다. 서명자는 아래와 같은 데이터를 통해 어떤 내용에 자신이 서명을 하는지 알 수 있다.(아래의 메세지는 meta mask 등의 지갑 어플리케이션에서 파싱되어 보여지며, EIP712 는 이러한 지갑 어플리케이션에서 제공하는 기능을 말미암에 제공된다.)</p>
<p>컨트랙트 도메인 타입의 정의</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domain = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"name"</span>, <span class="attr">type</span>: <span class="string">"string"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"version"</span>, <span class="attr">type</span>: <span class="string">"string"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"chainId"</span>, <span class="attr">type</span>: <span class="string">"uint256"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"verifyingContract"</span>, <span class="attr">type</span>: <span class="string">"address"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"salt"</span>, <span class="attr">type</span>: <span class="string">"bytes32"</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bid = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"amount"</span>, <span class="attr">type</span>: <span class="string">"uint256"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"bidder"</span>, <span class="attr">type</span>: <span class="string">"Identity"</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> identity = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"userId"</span>, <span class="attr">type</span>: <span class="string">"uint256"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">"wallet"</span>, <span class="attr">type</span>: <span class="string">"address"</span> &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> message = &#123;</span><br><span class="line">    amount: <span class="number">100</span>,</span><br><span class="line">    bidder: &#123;</span><br><span class="line">        userId: <span class="number">323</span>,</span><br><span class="line">        wallet: <span class="string">"0x3333333333333333333333333333333333333333"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>위처럼 서명하고자 하는 <strong>message</strong> 를 정의하였다면, 해당 메세지가 어떤 도메인 사업자(즉 DAPP 사업자로 이해할 수 있다) 에서부터 온 메세지인지를 나타내는 구분자인 <strong>Domain Separator</strong> 를 정의해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domainData = &#123;</span><br><span class="line">    name: <span class="string">"My amazing dApp"</span>,</span><br><span class="line">    version: <span class="string">"2"</span>,</span><br><span class="line">    chainId: <span class="built_in">parseInt</span>(web3.version.network, <span class="number">10</span>),</span><br><span class="line">    verifyingContract: <span class="string">"0x1C56346CD2A2Bf3202F771f50d3D14a367B48070"</span>,</span><br><span class="line">    salt: <span class="string">"0xf2d857f4a3edcb9b78b4d503bfe733db1e3f6cdc2b7971ee739626c97e86a558"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>name</strong>: DAPP 혹은 Protocol 의 이름</p>
<p><strong>version</strong>: DAPP 혹은 Platform version</p>
<p><strong>chainId</strong>: 테스트 넷인지 메인넷인지 등을 구분하는 chain id 로 EIP155 에서 제안되었다.</p>
<p><strong>verifyingContract</strong>: 해당 signature 를 verify 할 스마트 컨트랙트의 주소</p>
<p><strong>salt</strong>: 32 바이트의 hard code 된 유니크한 값으로 컨트랙트와 DAPP 사이에 공유되어 다른 DAPP 과 구분되는 최후의 보루이다.</p>
<p><strong>message type 과 Domain separator 가 정의되었다면 다음과 같이 Json 형태의 data 를 만들고 이를 stringily 시켜  sign 을 요청한다. </strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    types: &#123;</span><br><span class="line">        EIP712Domain: domain,</span><br><span class="line">        Bid: bid,</span><br><span class="line">        Identity: identity,</span><br><span class="line">    &#125;,</span><br><span class="line">    domain: domainData,</span><br><span class="line">    primaryType: <span class="string">"Bid"</span>,</span><br><span class="line">    message: message</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">web3.currentProvider.sendAsync(</span><br><span class="line">&#123;</span><br><span class="line">    method: <span class="string">"eth_signTypedData_v3"</span>,</span><br><span class="line">    params: [signer, data],</span><br><span class="line">    <span class="keyword">from</span>: signer</span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> signature = result.result.substring(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">const</span> r = <span class="string">"0x"</span> + signature.substring(<span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line">    <span class="keyword">const</span> s = <span class="string">"0x"</span> + signature.substring(<span class="number">64</span>, <span class="number">128</span>);</span><br><span class="line">    <span class="keyword">const</span> v = <span class="built_in">parseInt</span>(signature.substring(<span class="number">128</span>, <span class="number">130</span>), <span class="number">16</span>);</span><br><span class="line">    <span class="comment">// The signature is now comprised of r, s, and v.</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>data 내의 <code>types</code> 필드는 스마트 컨트랙트 내에서의 데이터 구조를 나타내며 반드시 <code>struct name</code> 과 정확히 일치해야한다. 또한 <code>PrimaryType</code> 은 데이터 구조에서의 최상위 자료 구조형이 무엇인지 명시한다.</p>
<h4><span id="validation-in-smart-contract">Validation in Smart contract</span></h4><p>클라이언트에서 signing 을 위해 formatting 과 hashing 을 거친 것처럼 같은 내용의 코드가 Smart Contract 에도 포함되어야 한다. 이 과정을 통해 <code>ecrecover</code> 함수를 통해 해당 서명에 사인한 account 의 address 를 알 수 있다.</p>
<p>인증을 위한 Contract 를 위해 제일 먼저 EIP712 에서 앞서 정의한 data type 을 struct 로 정의해야 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct Identity &#123;</span><br><span class="line">    uint256 userId;</span><br><span class="line">    address wallet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Bid &#123;</span><br><span class="line">    uint256 amount;</span><br><span class="line">    Identity bidder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그 다음으로는 위 data structure 에 맞는 <code>type hash</code> 를 정의해야 하며 그 코드는 다음과 같다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string private constant IDENTITY_TYPE = &quot;Identity(uint256 userId,address wallet)&quot;;</span><br><span class="line">string private constant BID_TYPE = &quot;Bid(uint256 amount,Identity bidder)Identity(uint256 userId,address wallet)&quot;;</span><br></pre></td></tr></table></figure>
<p>여기서 comma 와 bracket 사이에 공백이 들어가지 않는것을 유념하자. 또한, parameter 의 이름과 자료형이 클라이언트의 자료형과 변수명과 완벽하게 일치해야 한다.</p>
<p>또한 다음과 같이 <code>Domain Separator</code> 도 다음과 같이 hashify 되어야 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">uint256 constant chainId = 1;</span><br><span class="line">address constant verifyingContract = 0x1C56346CD2A2Bf3202F771f50d3D14a367B48070;</span><br><span class="line">bytes32 constant salt = 0xf2d857f4a3edcb9b78b4d503bfe733db1e3f6cdc2b7971ee739626c97e86a558;</span><br><span class="line">string private constant EIP712_DOMAIN = &quot;EIP712Domain(string name,string version,uint256 chainId,address verifyingContract,bytes32 salt)&quot;;</span><br><span class="line">bytes32 private constant DOMAIN_SEPARATOR = keccak256(abi.encode(</span><br><span class="line">    EIP712_DOMAIN_TYPEHASH,</span><br><span class="line">    keccak256(&quot;My amazing dApp&quot;),</span><br><span class="line">    keccak256(&quot;2&quot;),</span><br><span class="line">    chainId,</span><br><span class="line">    verifyingContract,</span><br><span class="line">    salt</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>아래와 같이 각 data 를 hashify 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function hashIdentity(Identity identity) private pure returns (bytes32) &#123;</span><br><span class="line">    return keccak256(abi.encode(</span><br><span class="line">        IDENTITY_TYPEHASH,</span><br><span class="line">        identity.userId,</span><br><span class="line">        identity.wallet</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hashBid(Bid memory bid) private pure returns (bytes32)&#123;</span><br><span class="line">    return keccak256(abi.encodePacked(</span><br><span class="line">        &quot;\\x19\\x01&quot;,</span><br><span class="line">       DOMAIN_SEPARATOR,</span><br><span class="line">       keccak256(abi.encode(</span><br><span class="line">            BID_TYPEHASH,</span><br><span class="line">            bid.amount,</span><br><span class="line">            hashIdentity(bid.bidder)</span><br><span class="line">        ))</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>마지막으로 다음과 같이 signature 를 verify 하는 함수를 작성해 준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function verify(address signer, Bid memory bid, sigR, sigS, sigV) public pure returns (bool) &#123;</span><br><span class="line">    return signer == ecrecover(hashBid(bid), sigV, sigR, sigS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="keccak256-hashing">Keccak256 hashing</span></h2><p>이더리움에서는 SHA3 해싱을 위해 <strong>keccak256</strong> 을 사용한다.</p>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/02/25/getting-started-with-dex/" itemprop="url">
                Getting started with DEX
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-25T09:56:01.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/dex/">dex</a><span>></span><a class="article-category-link" href="/categories/dex/blockchain/">blockchain</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                12 minutes read (About 1868 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <h2><span id="what-is-dex">What is DEX?</span></h2><p><strong>DEX</strong> 란 <strong>Decentralized Exchange</strong> 의 약어로 중간자 없이 가상화폐 지갑과 지갑 사이의 p2p 교환을 해주는 것이다.</p>
<p>DEX 에서는 <code>custody</code> 즉, 누가 거래에서의 키를 보관하는가에 대한 중대한 이슈가 있으며, DEX 는 모든 교환과정에 있어 개인이 키를 소유하고 완변하게 decentralized 되 토큰의 교환을 하는 것에 그 목적이 있다.</p>
<h2><span id="basic-procedure">Basic Procedure</span></h2><p>본 프로젝트에서 DEX 의 기본적인 프로세스는 다음과 같다.</p>
<p>먼저, 브라우저 상에서 토큰의 교환을 원하는 사용자가 <strong>매도 혹은 매수 주문</strong>을 걸면, 해당 주문정보를 EIP 712 로 서명한 서명정보와 함께 전달하면, <strong>Relayer API 를 통해 해당 기록이 off-chain 상의 orderbook 에 기록</strong>되게 된다. 그 이후, orderbook 을 조회하여 여러 주문들의 쌍을 받아와 <strong>교환이 가능한 거래쌍을 선정</strong>하여 <strong>스마트 컨트랙으로 전송</strong>한다.(즉, 하나의 taker order와 하나 이상의 maker order 들을 전달하며, 모든 주문은 서명이 완료된 주문이다. 여기서, 전송을 하는 과정에 있어 주문에 필요한 다양한 정보들을 전부 parameter 로 전달하면 gas 비 문제등 많은 문제들이 존재하기 때문에, <strong>거래에 필요한 데이터를 <code>data</code> 라는 필드로 만들어 <code>OrderParam</code> 에 포함하여 전달</strong>한다.</p>
<p>또한, <strong>위 과정을 진행함에 앞서</strong> 실제 거래의 주체가 아닌 relayer 를 통해 자금을 교환하기 때문에 플랫폼에서 만들어둔 <strong>relayer account 를 approve 하여 일정 자금에 대한 사용권한을 주어야</strong> 한다.</p>
<p>스마트 컨트랙에 전달된 인자들이 들어오면, 컨트랙은 주어진 주문 쌍을 분석하여 거래를 진행하기 위한 <code>Result</code> 들의 집합으로 나누고, 해당 주문을 <code>filled</code> 라는 <code>orderHash:amount</code> 쌍에 기록한다.</p>
<p><img src="/images/dex_process.png" alt="dex process"></p>
<h2><span id="smart-contract">Smart Contract</span></h2><h4><span id="주문의-전달">주문의 전달</span></h4><p>모든 주문은 Order Server 내의 orderbook 에 기록되고, 매칭이 가능한 조합들을 모아 스마트 컨트랙트의 <code>matchOrders</code> 를 호출하며, 그 인자는 다음과 같다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OrderParam memory takerOrderParam,</span><br><span class="line">OrderParam[] memory makerOrderParams,</span><br><span class="line">OrderAddressSet memory orderAddressSet</span><br></pre></td></tr></table></figure>
<p>여기서 order param 은 주문에 필요한 maker와 taker 의 요청정보이며, 그 형태는 다음과 같다.</p>
<p>OrderParam</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct OrderParam &#123;</span><br><span class="line">    address trader;</span><br><span class="line">    uint256 baseTokenAmount;</span><br><span class="line">    uint256 quoteTokenAmount;</span><br><span class="line">    uint256 gasTokenAmount;</span><br><span class="line">    bytes32 data; # 주문정보를 조합하여 32byte 로 축약, 가스비 절약 목적</span><br><span class="line">    OrderSignature signature; # EIP 712 서명</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위에서 <code>base token</code> 과 <code>quote token</code> 이 무엇인지 헷갈릴 수 있는데, <code>taker</code>가 매도 혹은 매수를 할때 기준이 되는 토큰을 <code>base token</code>이라고 한다. 즉, <code>taker</code> 가 특 정 토큰을 구매한다고 하면 그 구매의 대상이 되는 토큰을 base token 이라고 하며, 판매를 한다고 하면, 판매의 대상이 되는 그 토큰을 quote token 이라고 한다.</p>
<p>또한 여기서 <strong>OrderSignature 는 브라우저가 생성하고자 하는 주문정보를 EIP 712 로 서명한 서명정보</strong>로 추후 스마트 컨트랙트에서 해당 사용자의 주문정보를 해시하여 위 시그내처를 통해 유효성을 검증하는 과정을 거친다.</p>
<hr>
<p><strong>인증과정에서의 데이터의 흐름</strong></p>
<p>사용자의 orderParam 쌍 =&gt; param 의 data property 에서 order rebuild =&gt; EIP712 hash 를 orderParam 의 signature 로 validate</p>
<hr>
<p>* <strong><em>여기서 signature 의 목적은 무엇일까?</em></strong></p>
<p>여기서 signature 는 사용자가 본래 요청하고자 했던 주문정보가 스마트 컨트랙트에서 체결되는 시점에도 해당 사용자가 요청한 주문과 내용이 맞는지 검증하는 것이다.</p>
<p>가령, DEX 에서 두 사용자가 거래를 진행할때 다른 사용자가 특정 사용자의 계정을 스마트컨트랙에 거래를 요청하는 경우, 주문정보가 동일하더라도 주문을 작성한 유저가 요청한 주문이 아니므로 거래가 이루어 져서는 안되며, 특정 주문내용을 바꾸어서 컨트랙트에 체결을 요청하는 등 다양한 악용을 막는 역할을 수행한다.</p>
<p>* <strong><em>EIP 712 란 무엇인가?</em></strong></p>
<p>EIP 712 란 <strong>Ethereum Improvement Proposals 712</strong> 의 약어로 이더리움에서 향후 지원하게 될 다양한 제안들중 하나이다. 과거 사용자가 어떤 거래를 함에 있어 sign 을 할때에는 sign 의 대상이 되는 message 가 hash 화 되어 존재하기 때문에, 서명을 하는 사용자가 자신이 서명하는 내용에 대해 잘 알기 힘든 문제가 있었으며, 가령 유사한 해시값을 가진 피싱 사이트로 유도하여 사이닝을 유도한다던가 하는 다양한 위험에 노출되어 있었다.</p>
<p>이를 해결하기 위해 안전하고 값이 변조되지 않는 해싱을 보장하면서도 readability 를 가질 수 있는 서명방법을 고안하게 되었으며 그 제안내용이 EIP712 에 제안되었다.</p>
<p>EIP712 를 통해 사용자는 자신이 서명하는 정보에 대해 명확하게 인지할 수 있게 된다고 볼 수 있다.</p>
<p>EIP 서명의 절차에 대해 간략하게 소개하면, 먼저 서명을 하고자 하는 데이터의 형태를 정의하는데 이러한 <code>typed structured data</code> 를 먼저 정의하는 것으로 서명이 시작된다. 데이터의 정의가 완료되면, 여러 DAPP 들 사이에 구별되기 위한 <strong>domain separator</strong> 를 정하여 서명을 검증할 스마트 컨트랙트의 주소부터 version, salt 등의 데이터로 구성된다.</p>
<p>EIP 서명이 완료되면, 사용자는 signature 를 얻게 되며 추후 스마트 컨트랙트는 주문정보를 직접 해싱하여 사용자가 제공한 signature 로 validation 을 진행하여 유효성을 검증한다.</p>
<h4><span id="거래의-체결">거래의 체결</span></h4><p>matchOrders 함수가 호출되는 시점에 매칭된 오더들의 정보가 <code>filled</code> 에 <code>orderHash:filledAmount</code> 의 mapping 형태로 기록되며, 만약 주문이 체결되었다면 기존에 있던 주문들에 새로운 주문이 발생하면서 체결이 될 것이다.</p>
<p>여기서 기존에 있던 주문을 한 사용자를 <code>maker</code> 라 칭하며, 주문을 체결하는 주문을 발생시킨 사용자를 <code>taker</code> 라 명명한다.</p>
<p>또한, 거래의 특성상 <code>taker</code> 가 넣은 주문을 만족시키는데 필요한 하나 이상의 주문이 필요하게 되므로 주문이 매칭 될 때에는 하나의 <code>taker</code> 주문에 한개 이상의 <code>maker</code> 주문이 매칭된다.</p>
<h4><span id="taker-의-매도-주문">Taker 의 매도 주문</span></h4><p><code>taker</code> 의 매도주문으로 인해 주문이 체결되는 경우의 시나리오는 다음과 같으며, n개의 거래쌍이 이루어 졌다고 전제한다.</p>
<ol>
<li>maker 가 relayer 에게 만족하는 quote token 과 maker fee, maker gas fee(maker rebate fee 는 차감한다.) 를 n번 지급한다.</li>
<li><code>taker</code> 가 <code>maker</code> 에게 만족하는 base token 을 n번 지급한다.</li>
<li><code>relayer</code> 가 <code>taker</code> 에게 만족하는 quote token 중 taker gas fee 를 제하고 1회 지급한다.</li>
</ol>
<p><img src="/images/dex_taker_sell.png" alt="dex_taker_sell"></p>
<h4><span id="taker-의-매수-주문">Taker 의 매수 주문</span></h4><p><img src="/images/dex_taker_buy.png" alt="dex_taker_buy"></p>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/02/25/getting-started-with-solidity/" itemprop="url">
                Getting started with solidity
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-25T06:02:34.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
                
                    <span class="column is-narrow">
                        
                            
                                4 minutes read (About 650 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <!--toc-->
<h2><span id="restricting-access">Restricting Access</span></h2><p>하나의 컨트랙트 내의 속성들은 다른 컨트랙트에서 접근 될 수 없는 것이 기본이며, <code>public</code> 키워드를 명식적으로 사용함에 따라 다른 컨트랙트에서도 접근이 가능하게 된다.</p>
<p>또다른 접근 제한자로는 <code>modifier</code> 가 있는데, 이는 특정 함수에 지정하여 해당 함수를 호출하기 전에 자격에 맞지 않으면 접근을 제한 할 수 있는 기능을 제공한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">contract AccessRestriction &#123;</span><br><span class="line">	modifier onlyBy(address _account)</span><br><span class="line">    &#123;</span><br><span class="line">        require(</span><br><span class="line">            msg.sender == _account,</span><br><span class="line">            &quot;Sender not authorized.&quot;</span><br><span class="line">        );</span><br><span class="line">        // Do not forget the &quot;_;&quot;! It will</span><br><span class="line">        // be replaced by the actual function</span><br><span class="line">        // body when the modifier is used.</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="data-types">Data types</span></h2><h4><span id="memory-and-storage">memory and storage</span></h4><p>solidity 에서 memory 와 storage 를 이루는 데이터 chunk 의 크기는 32bytes 이다.</p>
<p><strong>memory</strong> 란 모든 함수 call 마다 새롭게 할당되는 임시 데이터 저장소로 이 메모리에 읽기, 쓰기 등의 작업을 수행할 때마다 가스비가 올라간다.</p>
<h4><span id="variables">variables</span></h4><p>솔리디티에서 변수는 memory address 를 가르치는 포인터이다.</p>
<h4><span id="array">array</span></h4><p>solidity 에서 array 의 첫번째 인자는 그 array 의 길이값을 저장한다.</p>
<h4><span id="bytes">Bytes</span></h4><p>solidity 에서 bytes 는 동적으로 할당되는 byte array 이며, 그 크기는 32byte 이다. 또한, solidity 에서 변수는 memory address 를 가르치는 포인터이므로 해당 포인터로 부터 32 바이트를 더해주면 실제로 해당 bytes 의 값이 저장된 주소값을 얻을 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b = new bytes(32);</span><br><span class="line">add(b, 32); // b의 값이 저장된 주소값</span><br><span class="line"></span><br><span class="line">mstore(add(b, 32), x); // b=x</span><br></pre></td></tr></table></figure>
<h2><span id="events">Events</span></h2><p>Event 는 솔리디티에서 일종의 로깅의 역할을 수행한다. 이더리움 상에서 일어나는 다양한 활동들에 대한 내역을 추적하고, 사용자 데이터를 자정하기 위해 이더리움은 로그 시스템을 적용하였으며, <strong>Event</strong> 의 발생은 일종의 로그 형태로 저장된다.</p>
<p><strong>DAPP</strong> 개발자는 이더리움의 RPC 인터페이스를 통해 이러한 이벤트들을 구독할 수 있다. <strong>Topic</strong> 은 이러한 이벤트들을 찾을 수 있도록 해주며, 가령 특정 컨트랙트에서 발생한 로그들을 듣는 등의 일들을 할 수 있다.</p>
<p>여기서 각 이벤트를 정의할 때 다음과 같이 <strong>indexed</strong> 옵션을 주면, 이렇게 구독을 하는 중에 해당 속성을 읽을 수 있다. 만약 <strong>indexed</strong> 옵션을 주지 않으며, ABI 인코딩된 데이터가 내려오게 된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract ExampleContract &#123;</span><br><span class="line">    event ExampleEvent(</span><br><span class="line">        address indexed _from,</span><br><span class="line">        bytes32 indexed _id,</span><br><span class="line">        uint _value</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                        
    </div>
    
            
</article>



        
    
        <article class="article content gallery" itemscope="" itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/02/24/getting-started-with-ethereum/" itemprop="url">
                Getting started with ethereum
            </a>
            
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-24T02:13:39.000Z" itemprop="datePublished">
                2 months ago
            </time>
        </span>
        
            <span class="column is-narrow article-category">
                <i class="far fa-folder"></i>
                <a class="article-category-link" href="/categories/ethereum/">ethereum</a><span>></span><a class="article-category-link" href="/categories/ethereum/blockchain/">blockchain</a>
            </span>
            
                
                    <span class="column is-narrow">
                        
                            
                                8 minutes read (About 1144 words)
                    </span>
                    
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
                    <h1><span id="getting-started-with-ethereum">Getting started with ethereum</span></h1><h2><span id="kinds-of-accounts">Kinds of accounts</span></h2><p>이더리움에는 두가지 종류의 account 가 있는데, <strong>External Account</strong> 와 <strong>Contract Account</strong> 가 그것이다.</p>
<p>먼저 <strong>External Account</strong> 는 공개키 방식의 계정이며, <strong>address 역할을 하는 public key</strong> 와 <strong>nonce</strong> 로 구성이 되며, <strong>Contract Account</strong> 는 일반적인 <strong>smart contract</strong> 이다.</p>
<p>여기서 <strong>account 와 account</strong> 사이에 자금이 이동하면 그것을 <strong>transaction</strong> 이라고 말한다.</p>
<h2><span id="transaction">Transaction</span></h2><p>이더리움에서 transaction 이란 하나의 EOA 로부터 다른 account 로 전송되는 message 를 포함한 signed data packet 을 의미하며 다음과 같은 정보들을 담고 있으며, EOA 로 부터 EOA 로 가는 경우는 이더를 송금하는 것을 내포하고, 만약 수신자가 Contract Account 라면 해당 contract 가 어떤 코드를 실행하도록 trigger 하는 것이 된다.</p>
<ul>
<li>receipient</li>
<li>signature</li>
<li>value</li>
<li>data:  which can contain the message sent to a contract</li>
</ul>
<p>여기서 data 는 contract 가 실행에 필요한 정보를 들고 있으며 Contract ABI(Application Binary Interface) 에 따라 컨트랙트와 소통한다. 이 ABI 는 외부 와컨트랙트 간의 상호작용에 필요할 뿐만 아니라 contract 간의 상호작용에도 적용된다.</p>
<p>따라서 data 는 다음의 규약에 따라 인코딩 되어 사용되며 <strong>ABI(Application Binary Interface</strong> 에 따라 정의된다.</p>
<h4><span id="함수-선택자">함수 선택자</span></h4><p>data 의 함수 시그니처의 Keccak-256 (SHA-3) hash 의 첫 4바이트는 어떤 함수를 호출할지를 나타내며 function 시그니처로 부터 도출된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.4.16 &lt;0.6.0;</span><br><span class="line"></span><br><span class="line">contract Foo &#123;</span><br><span class="line">  function bar(bytes3[2] memory) public pure &#123;&#125;</span><br><span class="line">  function baz(uint32 x, bool y) public pure returns (bool r) &#123; r = x &gt; 32 || y; &#125;</span><br><span class="line">  function sam(bytes memory, bool, uint[] memory) public pure &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위의 예제에서 baz 함수를 호출하고자 하는 transaction 의 data의 함수선택자는 <code>0xcdcd77c0</code> 인데 이는 method 의 id 로 ASCII format 으로 작성된 function signature 인 <code>baz(uint32,bool</code> 의 Keccak hash(sha3) 의 첫번째 4 바이트이다.</p>
<h4><span id="함수-parameter">함수 Parameter</span></h4><p>또한 해당 함수의 parameter 로 69와 true 를 제공한다면 69를 32바이트 로 패딩한 <code>0x0000000000000000000000000000000000000000000000000000000000000045</code> 가 값이 된다. <code>0x0000000000000000000000000000000000000000000000000000000000000001</code> </p>
<h4><span id="abiapplication-binary-interface">ABI(Application Binary Interface)</span></h4><p>컴퓨터 과학에서 흔히 말하는 ABI 는 <strong>두가지 종류의 binary 프로그램 모듈 사이의 인터페이스</strong>이다. 쉬운 예로는 <strong>library</strong> 와 <strong>operating</strong> 시스템의 경우가 있는데, 하나의 라이브러리는 여러 시스템 상에서 동작해야 하므로 해당 소스코드가 다양한 운영체제에서 동작하기 위해서는 약속된 인터페이스가 필요하다. 또 한 예로는 유저에 의해 실행되는 프로그램의 예가 있는데 가령 여러 운영체제에서 해당 프로그램을 실행하여도 동작하기 위해서는 이러한 ABI 가 정의되어 있어야 한다.</p>
<p>이와 같은 맥락에서 이더리움 에서의 ABI 란 특정 함수가 이더리움에서 실행되기 위한 포맷팅의 규약으로써 이해될 수 있다.</p>
<p>아래는 스마트 컨트랙트 내에서 특정 데이터를 ABI 인코딩 하는 것을 보여준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abi.encode(&quot;AAAA&quot;)</span><br></pre></td></tr></table></figure>
<p>위 코드는 아래와 같이 3단어로 구성된 96(32byte *3) 사이즈의 바이트 문자열을 리턴한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000000000000000000000000000000000000000000000000000000020</span><br><span class="line">0x0000000000000000000000000000000000000000000000000000000000000004</span><br><span class="line">0x4141414100000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure>
<p>한 줄씩 살펴보면 먼저 첫번째 라인은 해당 문자열의 starting offset(32 in decimal) 를 32byte 문자열에 padding 한 것이며, 두번째 문자열은 인코딩 하는 데이터의 길이인 4를 32바이트 문자열에 padding 하여 나타낸다. 마지막으로 세번째 문자열은 실제 우리의 데이터인 “AAAA” 를 UTF-8 인코딩하여 32 바이트 문자열에 padding 하여 나타내어 준다.</p>
<p>위의 encoding 방식보다 다소 간편하게 인코딩을 하고 싶다면  <code>abi.encodePacked(&quot;AAAA&quot;)</code>  라는 함수를 사용할 수 있다. 이 함수는 32바이트보다 작은 문자는 그냥 해당 문자열을 바이트로 출력하고 32바이트에 padding 하지도 않는다.</p>
<p>한가지 흥미로운 사실이 있는데, <code>keccak256</code> 을 사용하여 hashing 을 할때 복수개의 인자를 전달하면 이것을 내부적으로 <code>abi.encodePacked</code> 함수로 인코딩 하여 해싱을 한다는 것이다. 현재는 복수개의 인자를 전달하면 warning 을 출력하기는 하지만, 알아두도록 하자.</p>
<p>다음은 Keccak256 에서 <code>abi.encodePacked</code> 를 사용하는 예이다. 아래의 두 hashing 은 정확히 동일한 역할을 수행한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keccak256(&quot;AAAA&quot;, &quot;BBBB&quot;, 42);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keccak256(abi.encodePacked(&quot;AAAA&quot;, &quot;BBBB&quot;, 42));</span><br></pre></td></tr></table></figure>

                        
    </div>
    
            
</article>



        
    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous">
        <a href="/">Prev</a>
    </div>
    <div class="pagination-next">
        <a href="/page/3/">Next</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link" href="/">1</a></li>
        
        <li><a class="pagination-link is-current" href="/page/2/">2</a></li>
        
        <li><a class="pagination-link" href="/page/3/">3</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="/page/21/">21</a></li>
        
    </ul>
</nav>
    
    </div>
</section>

            <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2019 Jake.Lee 이남훈&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" href="https://github.com/frontalnh">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
                <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        //plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110077250-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-110077250-2');
</script>


    


<script src="/js/script.js"></script>

                    
                        <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
                            
</body>

</html>